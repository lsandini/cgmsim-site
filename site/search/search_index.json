{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Welcome to the CGMSIM documentation \u2301 Introduction \u2301 This application simulates very basically in real time the effects of food and insulin analogs on the blood glucose of a patient with type 1 diabetes (T1D). Rather than blood glucose (BG) values, it displays a continuous glucose sensor (CGM) trace using Nightscout as visualization tool. Since even the most accurate physiological simulators can at best provide only an approximation of what happens in a living organism, the goal of this simulation is not even to try to match reality, but to provide a framework for practising, learning and/or teaching. The treatment goal in type 1 diabetes is to keep the BG or CGM curve values as close as possible to that of a healthy person. In realistic terms, it means 3.9 \u2013 10 mmol/l or 70-180 mg/dl for CGM curves. The Time In Range (TIR) should be at least 70%. Important Please understand that this simulation: cannot predict individual response to treatment cannot replace traditional patient/caregiver education does not depict 100% realistically human physiology This is work in progress, and all feedback is welcome ! Human physiology \u2301 To understand the mechanics of the simulation, a few things must be considered. After a meal, the absorption of carbohydrates from the gut will also increase the blood glucose. Since insulin replacement is administered subcutaneously and not directly into the hepatic portal vein, some of the ingested food will be absorbed into the main bloodstream directly, bypassing the liver. After a short delay, the CGM will reflect the increase of blood glucose. The endogenous glucose production (EGP) is mainly du to the liver release of glucose into the bloodstream. Either releasing stores (glycogenolysis) or synthesizing new glucose (neoglucogenesis). Various biological states, alcohol and hormones can affect EGP. As glucose is released into the blood stream, the blood glucose concentration increases. Physical exercise affects blood glucose in many ways. Short bouts of intense physical activity will trigger the release of adrenalin, which in turn increases the EGP. In turn, the increased peripheral uptake of glucose in the muscle tissue will lower the blood glucose as physical activity continues. The same continues also during the post exercise phase, until the muscle glycogen stores are repleted. Mealtime insulins have a short duration of activity (DIA, ~3 hours), while long-acting insulin analogs are meant to be injected once or twice a day. Both will lower blood glucose and thus sensor glucose values. The intricate biological pathways affecting the blood glucose variations are difficult to replicate mathematically. The absorption of ingested food from the gut, the absorption of insulin from the subcutaneous tissue, the timing of exercise, the circadian rhythm, menstrual cycle, the moon phase and the alignment of planets all seem to play a role. Adding a touch of random variation (or chaos) brings some realism in the simulation. Why use a simulator ? \u2301 Many scenario-based simulators have been written in the past, like AIDA or the UVA/Padova T1DMS . In contrast, CGMSIM runs in real time like a \"serious game\". It requires time and dedication to reach its goal. It's not a matter of hours or days, but rather weeks or months. Many instances of the simulator can run on one computer, serving many users at a time, making team training possible. Healthcare Professionals - HCPs Unless you or your family member has T1D, it is hard to figure how treatment can be time-consuming, technically difficult or frustrating. Even without having to worry about the risk of long-term vascular complications or acute life-threatening hypoglycemia, early adopters of this simulator showed signs of treatment fatigue after a few weeks already. Living with incertainty 24/7, and facing reports of treatment \"success\" will teach some humility and empathy. Not all patients are equal... Every simulated patient can be defined in terms of weight, insulin sensitivity, amplitude of EGP variability. This website will describe step by step how to install and kickstart the simulation as an administrator, and how to use it as an end-user. Where is the source code ? \u2301 The source code and more technical details on how various scripts are excecuted and interact with each other can be found in the CGMSIM projet's repository","title":"Home"},{"location":"#welcome-to-the-cgmsim-documentation","text":"","title":"Welcome to the CGMSIM documentation"},{"location":"#introduction","text":"This application simulates very basically in real time the effects of food and insulin analogs on the blood glucose of a patient with type 1 diabetes (T1D). Rather than blood glucose (BG) values, it displays a continuous glucose sensor (CGM) trace using Nightscout as visualization tool. Since even the most accurate physiological simulators can at best provide only an approximation of what happens in a living organism, the goal of this simulation is not even to try to match reality, but to provide a framework for practising, learning and/or teaching. The treatment goal in type 1 diabetes is to keep the BG or CGM curve values as close as possible to that of a healthy person. In realistic terms, it means 3.9 \u2013 10 mmol/l or 70-180 mg/dl for CGM curves. The Time In Range (TIR) should be at least 70%. Important Please understand that this simulation: cannot predict individual response to treatment cannot replace traditional patient/caregiver education does not depict 100% realistically human physiology This is work in progress, and all feedback is welcome !","title":"Introduction"},{"location":"#human-physiology","text":"To understand the mechanics of the simulation, a few things must be considered. After a meal, the absorption of carbohydrates from the gut will also increase the blood glucose. Since insulin replacement is administered subcutaneously and not directly into the hepatic portal vein, some of the ingested food will be absorbed into the main bloodstream directly, bypassing the liver. After a short delay, the CGM will reflect the increase of blood glucose. The endogenous glucose production (EGP) is mainly du to the liver release of glucose into the bloodstream. Either releasing stores (glycogenolysis) or synthesizing new glucose (neoglucogenesis). Various biological states, alcohol and hormones can affect EGP. As glucose is released into the blood stream, the blood glucose concentration increases. Physical exercise affects blood glucose in many ways. Short bouts of intense physical activity will trigger the release of adrenalin, which in turn increases the EGP. In turn, the increased peripheral uptake of glucose in the muscle tissue will lower the blood glucose as physical activity continues. The same continues also during the post exercise phase, until the muscle glycogen stores are repleted. Mealtime insulins have a short duration of activity (DIA, ~3 hours), while long-acting insulin analogs are meant to be injected once or twice a day. Both will lower blood glucose and thus sensor glucose values. The intricate biological pathways affecting the blood glucose variations are difficult to replicate mathematically. The absorption of ingested food from the gut, the absorption of insulin from the subcutaneous tissue, the timing of exercise, the circadian rhythm, menstrual cycle, the moon phase and the alignment of planets all seem to play a role. Adding a touch of random variation (or chaos) brings some realism in the simulation.","title":"Human physiology"},{"location":"#why-use-a-simulator","text":"Many scenario-based simulators have been written in the past, like AIDA or the UVA/Padova T1DMS . In contrast, CGMSIM runs in real time like a \"serious game\". It requires time and dedication to reach its goal. It's not a matter of hours or days, but rather weeks or months. Many instances of the simulator can run on one computer, serving many users at a time, making team training possible. Healthcare Professionals - HCPs Unless you or your family member has T1D, it is hard to figure how treatment can be time-consuming, technically difficult or frustrating. Even without having to worry about the risk of long-term vascular complications or acute life-threatening hypoglycemia, early adopters of this simulator showed signs of treatment fatigue after a few weeks already. Living with incertainty 24/7, and facing reports of treatment \"success\" will teach some humility and empathy. Not all patients are equal... Every simulated patient can be defined in terms of weight, insulin sensitivity, amplitude of EGP variability. This website will describe step by step how to install and kickstart the simulation as an administrator, and how to use it as an end-user.","title":"Why use a simulator ?"},{"location":"#where-is-the-source-code","text":"The source code and more technical details on how various scripts are excecuted and interact with each other can be found in the CGMSIM projet's repository","title":"Where is the source code ?"},{"location":"contact/","text":"Contact me ! \u2301 If you have suggestions or would like to contribut, feel free to contact me by email lsandini@gmail.com . Thank you !","title":"Contact me"},{"location":"contact/#contact-me","text":"If you have suggestions or would like to contribut, feel free to contact me by email lsandini@gmail.com . Thank you !","title":"Contact me !"},{"location":"build/clone/","text":"Downloading the simulator \u2301 Cloning the repository \u2301 Log into your Ubuntu terminal, and then run this command : git clone https://github.com/lsandini/cgmsim.git That's it. A folder called cgmsim has been made for you and all the needed files are in there. If you'd like to run more simulators on the same machine, just run: git clone https://github.com/lsandini/cgmsim.git cgmsim2 ... and a separate folder called \"cgmsim2\" is made, identical to \"cgmsim\" Installing dependencies \u2301 Enter the installation directory of your choice with the cd command (cd = change directory): cd cgmsim or cd cgmsim2 ... or whatever your named your install folder. In your linux terminal, type: sudo bash install_dependencies.sh Your password will be required. You might see warnings during the installation and it might take a little while. Disregard the warnings and just wait for the process to complete.","title":"Download"},{"location":"build/clone/#downloading-the-simulator","text":"","title":"Downloading the simulator"},{"location":"build/clone/#cloning-the-repository","text":"Log into your Ubuntu terminal, and then run this command : git clone https://github.com/lsandini/cgmsim.git That's it. A folder called cgmsim has been made for you and all the needed files are in there. If you'd like to run more simulators on the same machine, just run: git clone https://github.com/lsandini/cgmsim.git cgmsim2 ... and a separate folder called \"cgmsim2\" is made, identical to \"cgmsim\"","title":"Cloning the repository"},{"location":"build/clone/#installing-dependencies","text":"Enter the installation directory of your choice with the cd command (cd = change directory): cd cgmsim or cd cgmsim2 ... or whatever your named your install folder. In your linux terminal, type: sudo bash install_dependencies.sh Your password will be required. You might see warnings during the installation and it might take a little while. Disregard the warnings and just wait for the process to complete.","title":"Installing dependencies"},{"location":"build/kickstart/","text":"","title":"Kickstart"},{"location":"build/linux/","text":"","title":"Linux/Ubuntu"},{"location":"build/nightscout/","text":"Nightscout \u2301 In order to use this simulator, you'll need an instance of Nightscout (NS). Nightscout is hosted on Heroku, a cloud-based platform. You don't have to worry about running your own server, registering domains, making backups, losing internet connections, etc... Nightscout requires a database to run, where all the food and insulin \"treatments\" are stored, along with the sensor glucose values. This \"Mongo\" database must be created and linked to your Nightscout website. Please go over to Nightscout's installation guide for new users . The whole installation is well explained, step by step. Make sure to follow all the steps and perform this installation first. It will take you some time, probably about 60 minutes. Write down the URL of your Nightscout website and the password or APISECRET (for example \"MYAPISECRET1\" as in the following example). Running Nightscout on Heroku on \"free dynos\" is free of charge. However, if the amount of work done on the server exceeds a certain limit, your \"free dynos\" will be exhausted and your site will stop working until the following month. Upgrading your account to \"hobby dynos\" (7 USD or 6 EUR / month) means your site will run without interruptions.","title":"Nightscout"},{"location":"build/nightscout/#nightscout","text":"In order to use this simulator, you'll need an instance of Nightscout (NS). Nightscout is hosted on Heroku, a cloud-based platform. You don't have to worry about running your own server, registering domains, making backups, losing internet connections, etc... Nightscout requires a database to run, where all the food and insulin \"treatments\" are stored, along with the sensor glucose values. This \"Mongo\" database must be created and linked to your Nightscout website. Please go over to Nightscout's installation guide for new users . The whole installation is well explained, step by step. Make sure to follow all the steps and perform this installation first. It will take you some time, probably about 60 minutes. Write down the URL of your Nightscout website and the password or APISECRET (for example \"MYAPISECRET1\" as in the following example). Running Nightscout on Heroku on \"free dynos\" is free of charge. However, if the amount of work done on the server exceeds a certain limit, your \"free dynos\" will be exhausted and your site will stop working until the following month. Upgrading your account to \"hobby dynos\" (7 USD or 6 EUR / month) means your site will run without interruptions.","title":"Nightscout"},{"location":"build/overview/","text":"Installation overview \u2301 Nightscout \u2301 In order to use this simulator, you'll need an instance of Nightscout (NS). If you are not familiar with NS, go over to Nightscout new users and be sure to follow all the steps and perform this installation first. Make sure to write down the URL and the APISECRET (for example \"MYAPISECRET1\"). The CGMSIM simulator itself \u2301 The simulator itself works in a Linux Ubuntu 20.04 LTS environment. You'll need a computer or a virtual machine running Ubuntu in order to complete the CGMSIM installation. I recommend using a Raspberry Pi (RPi) device, as it is the cheapest and most energy efficient solution. I currently host 10 simulated patients on a headless RPi3, without any monthly cost other than my broadband internet subscription. I do not recommend running the simulation as the root user. Instead, create a regular user with sudo privileges, in my case \"lorenzo\". There are plenty of tutorials for that. The next steps are descibed separately and they involve: downloading all the files from this Github repository installating the dependencies necessary for running the simulator setting up the environment variables kickstarting the simulator scheduling the tasks Using CGMSIM in a browser \u2301 Nightscout is broadly compatible with a wide range of browsers, both on desktop/laptop computers and handheld devices. The use of CGMSIM happens is a browser, and it doesn't require any app installation by its user.","title":"Overview"},{"location":"build/overview/#installation-overview","text":"","title":"Installation overview"},{"location":"build/overview/#nightscout","text":"In order to use this simulator, you'll need an instance of Nightscout (NS). If you are not familiar with NS, go over to Nightscout new users and be sure to follow all the steps and perform this installation first. Make sure to write down the URL and the APISECRET (for example \"MYAPISECRET1\").","title":"Nightscout"},{"location":"build/overview/#the-cgmsim-simulator-itself","text":"The simulator itself works in a Linux Ubuntu 20.04 LTS environment. You'll need a computer or a virtual machine running Ubuntu in order to complete the CGMSIM installation. I recommend using a Raspberry Pi (RPi) device, as it is the cheapest and most energy efficient solution. I currently host 10 simulated patients on a headless RPi3, without any monthly cost other than my broadband internet subscription. I do not recommend running the simulation as the root user. Instead, create a regular user with sudo privileges, in my case \"lorenzo\". There are plenty of tutorials for that. The next steps are descibed separately and they involve: downloading all the files from this Github repository installating the dependencies necessary for running the simulator setting up the environment variables kickstarting the simulator scheduling the tasks","title":"The CGMSIM simulator itself"},{"location":"build/overview/#using-cgmsim-in-a-browser","text":"Nightscout is broadly compatible with a wide range of browsers, both on desktop/laptop computers and handheld devices. The use of CGMSIM happens is a browser, and it doesn't require any app installation by its user.","title":"Using CGMSIM in a browser"},{"location":"build/setupscript/","text":"","title":"Setup"},{"location":"model/food/","text":"Modeling the absorption of Carbs from the gut \u2301 There are many complicated and more or less precise published models of carb absorption, but for the purpose of this simulation, a simple bilinear model like the one found in the book Think Like a Pancreas by Gary Scheiner, and used in Perceptus' Glucodyn simulator will do for now. . So if the total absorption time (AT) is 4 hours, the absorption rate increases linearly until it reaches its peak, then decreases linearly to the end. The surface area of the triangle represents the amount of ingested carbs (the \"Dose\"). The peak absorption rate is \"h\". This can be represented with the equivalent following equations: \\[ Dose = {AT \\times h \\over 2} \\] \\[ h = {{2 \\times Dose } \\over AT} \\] Let's get rid of the \"h\", and describe the Carbs Absorption Rate (CAR) as a function of time : In the increasing phase of absorption : \\[ CAR(t) = {2 \\times h} \\times {t \\over AT }\\text{ } => \\text{ } { 4 \\times Dose \\over AT^2} \\times t \\] - And in the decreasing phase: \\[ CAR(t) = {2 \\times h} \\times {(1 - t) \\over AT } \\text{ } => \\text{ } { 4 \\times Dose \\over AT} \\times {(1 - {t \\over AT})} \\] Mixed meals and Snacks To make the absorption of carbs more realistic, the first 40 g of each meal will always be fast absorbing . For bigger meals, the excess carbs over 40g are divided in fast and slow absorbing parts. The ratio of fast absorbing carbs is randomly computed to be 10-40 \\% of the carb excess . So for a meal declared as 100g, the first 40 are fast carbs. The remaining 60g will be divided randomly in slow and fast parts. You'll find out sooner or later. In the current version of the simulator, fast carbs will be absorbed according to the bilinear model mentioned above, over a period of time of one hour . The remaining (slow) carbs are absorbed in a similar bilinear fashion, but over a period of 4 hours. This can be set in the interactive setup script during installation.","title":"Carb absorption from the gut"},{"location":"model/food/#modeling-the-absorption-of-carbs-from-the-gut","text":"There are many complicated and more or less precise published models of carb absorption, but for the purpose of this simulation, a simple bilinear model like the one found in the book Think Like a Pancreas by Gary Scheiner, and used in Perceptus' Glucodyn simulator will do for now. . So if the total absorption time (AT) is 4 hours, the absorption rate increases linearly until it reaches its peak, then decreases linearly to the end. The surface area of the triangle represents the amount of ingested carbs (the \"Dose\"). The peak absorption rate is \"h\". This can be represented with the equivalent following equations: \\[ Dose = {AT \\times h \\over 2} \\] \\[ h = {{2 \\times Dose } \\over AT} \\] Let's get rid of the \"h\", and describe the Carbs Absorption Rate (CAR) as a function of time : In the increasing phase of absorption : \\[ CAR(t) = {2 \\times h} \\times {t \\over AT }\\text{ } => \\text{ } { 4 \\times Dose \\over AT^2} \\times t \\] - And in the decreasing phase: \\[ CAR(t) = {2 \\times h} \\times {(1 - t) \\over AT } \\text{ } => \\text{ } { 4 \\times Dose \\over AT} \\times {(1 - {t \\over AT})} \\] Mixed meals and Snacks To make the absorption of carbs more realistic, the first 40 g of each meal will always be fast absorbing . For bigger meals, the excess carbs over 40g are divided in fast and slow absorbing parts. The ratio of fast absorbing carbs is randomly computed to be 10-40 \\% of the carb excess . So for a meal declared as 100g, the first 40 are fast carbs. The remaining 60g will be divided randomly in slow and fast parts. You'll find out sooner or later. In the current version of the simulator, fast carbs will be absorbed according to the bilinear model mentioned above, over a period of time of one hour . The remaining (slow) carbs are absorbed in a similar bilinear fashion, but over a period of 4 hours. This can be set in the interactive setup script during installation.","title":"Modeling the absorption of Carbs from the gut"},{"location":"model/la-agonists/","text":"Modeling the activities of the long-acting agonists \u2301 For detemir and glargine instead, mathematical models are missing. Based on clamp studies in T1D, the intra-individual day-to-day variation is an important factor affecting the predictability of a single repeated dose. Moreover, the inter-individual variability makes modeling even more a challenge. Even with the best curve-fitting tools, no \u201cglobal model\u201d was achieved. Since the goal is not to make a perfect model, I first decided to use a sinusoidal curve to model detemir, and a half-ellipse for glargine. The obvious reasons are that the mathematics are simple \ud83d\ude2c Using biexponential models \u2301 While the very basic mathematical models of long acting insulin analogs are good enough for training (see blow), getting closer to published \"curves\" and physiological activity is necessary. I decided to adopt the biexponential model used for mealtime insulins to long-acting insulin agonists. The activity of detemir and glargine-U100 depend on the absolute amount (units), but also on the dose in relation to the patient's weight (U/kg). Also, the peak of action is achieved at different timepoints. The DIA of detemir is more variable and dose dependent than that of glargine. Models for glargine U300 and degludec will be added later on, if anyone finds them useful. Bi-exponential models For detemir, the duration of action is 14h + (24* dose/weight), and the peak is at duration/3. For glargine U100, the duration of action is 22h + (12* dose/weight), and the peak is at duration/2.5. Here are some activity curves as depicted in many publications. Notice that the curve colours are different, and some of the activity curves seem to derived from steady-state euglycemic clamps. : OLD MODELS ! \u2301 Important The old models for detemir and glargine U100 are still in use in the current version of the simulator, so here is the technical explanation for those still using them. They will be deprecated after the new model have been thouroughly tested. Modeling Levemir (Levemir\u00ae) \u2301 The clamp studies show that the dose-response curve is linear. With increasing doses from 0.1U/kg to 1.6U/kg, the total activity, or area under the curve (AUC) of the glucose infusion rate (GIR) needed to maintain normal blood glucose follows a straight line. However, the DIA seems related to the dose/kg, so that had to be considered in the model. The AUC precisely reflects the injected number of units and is identical for 12U @0.1U/kg and 12U @0.4U/kg. However, when increasing the do dose from 12U @0.4U/kg to 24U @0.4U/kg, you can see that the DIA increases: Duration of Levemir action = 16 + (20 * U/weight) So for 0.1 U/kg, the duration of action is 16+(20 * 0.1) = 18 hours, and for 0.4U/kg, the DIA is 16+(20 * 0.4) = 24 hours. And the model itself is: y= units * (Math.PI/(duration * 2)) * (Math.sin(time * Math.PI/duration)); (for the biexponential model in detemir2.js, the duration of activity = (14 + (24 * dose/weight)), and the peak is duration/3. Modeling Glargine (Lantus\u00ae, Abasaglar\u00ae, Toujeo\u00ae) \u2301 For the time being, only glargine U100 is basically modeled here, with a DIA of 27 hours. Again, the AUC reflects the injected dose. I \u201cchopped\u201d the equation in little bits fo clarity : b = (2 * basalDose)/(Math.PI * duration); // duration is 27 hours x = (Date.now() - time0)/(60 * 60 * 1000); //time0 is the time of injection g = x-(duration / 2); gg = Math.pow(g,2); h = duration / 2; hh= Math.pow(h,2); z = (x-gg) / hh; bb = Math.pow(b,2); y = 2 * Math.sqrt(bb * (1+z)); // where y is the activity of glargine over time (for the biexponential model in glargine2.js, the duration of activity = (22 + (12 * dose/weight)), and the peak is duration/2.5 . Here is a visual aid illustrating the differences between the activity curves of detemir and glargine at different doses:","title":"Long-acting insulin Agonists"},{"location":"model/la-agonists/#modeling-the-activities-of-the-long-acting-agonists","text":"For detemir and glargine instead, mathematical models are missing. Based on clamp studies in T1D, the intra-individual day-to-day variation is an important factor affecting the predictability of a single repeated dose. Moreover, the inter-individual variability makes modeling even more a challenge. Even with the best curve-fitting tools, no \u201cglobal model\u201d was achieved. Since the goal is not to make a perfect model, I first decided to use a sinusoidal curve to model detemir, and a half-ellipse for glargine. The obvious reasons are that the mathematics are simple \ud83d\ude2c","title":"Modeling the activities of the long-acting agonists"},{"location":"model/la-agonists/#using-biexponential-models","text":"While the very basic mathematical models of long acting insulin analogs are good enough for training (see blow), getting closer to published \"curves\" and physiological activity is necessary. I decided to adopt the biexponential model used for mealtime insulins to long-acting insulin agonists. The activity of detemir and glargine-U100 depend on the absolute amount (units), but also on the dose in relation to the patient's weight (U/kg). Also, the peak of action is achieved at different timepoints. The DIA of detemir is more variable and dose dependent than that of glargine. Models for glargine U300 and degludec will be added later on, if anyone finds them useful. Bi-exponential models For detemir, the duration of action is 14h + (24* dose/weight), and the peak is at duration/3. For glargine U100, the duration of action is 22h + (12* dose/weight), and the peak is at duration/2.5. Here are some activity curves as depicted in many publications. Notice that the curve colours are different, and some of the activity curves seem to derived from steady-state euglycemic clamps. :","title":"Using biexponential models"},{"location":"model/la-agonists/#old-models","text":"Important The old models for detemir and glargine U100 are still in use in the current version of the simulator, so here is the technical explanation for those still using them. They will be deprecated after the new model have been thouroughly tested.","title":"OLD MODELS !"},{"location":"model/la-agonists/#modeling-levemir-levemir","text":"The clamp studies show that the dose-response curve is linear. With increasing doses from 0.1U/kg to 1.6U/kg, the total activity, or area under the curve (AUC) of the glucose infusion rate (GIR) needed to maintain normal blood glucose follows a straight line. However, the DIA seems related to the dose/kg, so that had to be considered in the model. The AUC precisely reflects the injected number of units and is identical for 12U @0.1U/kg and 12U @0.4U/kg. However, when increasing the do dose from 12U @0.4U/kg to 24U @0.4U/kg, you can see that the DIA increases: Duration of Levemir action = 16 + (20 * U/weight) So for 0.1 U/kg, the duration of action is 16+(20 * 0.1) = 18 hours, and for 0.4U/kg, the DIA is 16+(20 * 0.4) = 24 hours. And the model itself is: y= units * (Math.PI/(duration * 2)) * (Math.sin(time * Math.PI/duration)); (for the biexponential model in detemir2.js, the duration of activity = (14 + (24 * dose/weight)), and the peak is duration/3.","title":"Modeling Levemir (Levemir\u00ae)"},{"location":"model/la-agonists/#modeling-glargine-lantus-abasaglar-toujeo","text":"For the time being, only glargine U100 is basically modeled here, with a DIA of 27 hours. Again, the AUC reflects the injected dose. I \u201cchopped\u201d the equation in little bits fo clarity : b = (2 * basalDose)/(Math.PI * duration); // duration is 27 hours x = (Date.now() - time0)/(60 * 60 * 1000); //time0 is the time of injection g = x-(duration / 2); gg = Math.pow(g,2); h = duration / 2; hh= Math.pow(h,2); z = (x-gg) / hh; bb = Math.pow(b,2); y = 2 * Math.sqrt(bb * (1+z)); // where y is the activity of glargine over time (for the biexponential model in glargine2.js, the duration of activity = (22 + (12 * dose/weight)), and the peak is duration/2.5 . Here is a visual aid illustrating the differences between the activity curves of detemir and glargine at different doses:","title":"Modeling Glargine (Lantus\u00ae, Abasaglar\u00ae, Toujeo\u00ae)"},{"location":"model/liver/","text":"Modeling the Endogenous Glucose Production (EGP) by the liver \u2301 In an adult person with T1D, the EGP is about 100-120mg/kg/h, which means 8-10g/h for a 80kg person. Every day, the liver releases 200-240g of carbs into the bloodstream. The EGP is significantly affected by the insulin activity, since in the repleted and rested state, insulin decreases the liver glucose production more than it increases peripheral glucose uptake. Moreover, other factors like the ingestion of alcohol, an adrenaline rush, prolonged fasting, will significantly increase or decrease the EGP. The EGP is modeled here as a simple sinusoidal function. If the ISF is 2mmol/l/U and the CR is 10g/U, then the Carb Factor (CF) is 2mmol/l/10g. Since 10g are produced per hour (on average), the increase in BG due to the liver glucose production is 2mmol/l/h or 0.167 mmol/l/5min. Multiplying this by a sinusoidal value oscillating from 0.8 to 1.2 (\u00b1 20 %) will make the impact on BG vary from 0.13 to 0.20 mmol/l/5min. The sinus cycle starts at midnight, is maximal at 6 AM (mimicking a dawn effect or \"liver dump\"), back to baseline at 12 AM, minimal at 6 PM (mimicking the effect of light physical activity), and back to baseline at midnight.","title":"Endogenous Glucose production"},{"location":"model/liver/#modeling-the-endogenous-glucose-production-egp-by-the-liver","text":"In an adult person with T1D, the EGP is about 100-120mg/kg/h, which means 8-10g/h for a 80kg person. Every day, the liver releases 200-240g of carbs into the bloodstream. The EGP is significantly affected by the insulin activity, since in the repleted and rested state, insulin decreases the liver glucose production more than it increases peripheral glucose uptake. Moreover, other factors like the ingestion of alcohol, an adrenaline rush, prolonged fasting, will significantly increase or decrease the EGP. The EGP is modeled here as a simple sinusoidal function. If the ISF is 2mmol/l/U and the CR is 10g/U, then the Carb Factor (CF) is 2mmol/l/10g. Since 10g are produced per hour (on average), the increase in BG due to the liver glucose production is 2mmol/l/h or 0.167 mmol/l/5min. Multiplying this by a sinusoidal value oscillating from 0.8 to 1.2 (\u00b1 20 %) will make the impact on BG vary from 0.13 to 0.20 mmol/l/5min. The sinus cycle starts at midnight, is maximal at 6 AM (mimicking a dawn effect or \"liver dump\"), back to baseline at 12 AM, minimal at 6 PM (mimicking the effect of light physical activity), and back to baseline at midnight.","title":"Modeling the Endogenous Glucose Production (EGP) by the liver"},{"location":"model/mealtime/","text":"Modeling the activity of mealtime insulins \u2301 While simple \"bilinear\" models have been used in the past, precise modeling has been done for aspart and lispro. The biexponential model by Dragan Maksimovic described here fits the published data from clamp studies. Dragan has made a tremendous work with this model, adopted now by all DIY artificial pancreas algorithms. A very good explanation of this various models in given in the openAPS documentation . I use model to this compute the activity of each mealtime insulin dose. I selected a time-to-peak of 60 minutes and a duration of insulin action (DIA) of 300 min (5 hours!) as default. Mealtime insulins have a duration of activity closer to 180 min or 3 hours. For faster insulin aspart (Fiasp\u00ae), you may want to choose an even shorter time-to-peak and DIA. You will be able to set your own time-to-peak and DIA values during the interactive setup, along with other \"patient-related\" variables. In simple terms, this means that the effect of insulin will increase from the moment of injection until it reaches a maximum \"peak\", and then decrease to 0 at the end of the DIA. Parameters \u2301 td = duration duration of insulin activity (DIA) tp = peak activity time \\[ \\text{Time constant of exponential decay = } \\tau = { tp \\times {{(1-tp/td)}\\over {(1-2 \\times tp/td)} } } \\] \\[ \\text{Rise time factor = } a = { 2 \\times {\\tau \\over td}} \\] \\[ \\text{Auxiliary scale factor = } S = {1 \\over {(1 -a) + (1 + a)\\times {\\exp({-t\\over \\tau})}}} \\] \\[ \\text{Insulin activity curve = } Ia(t) = {S \\over \\tau^2} \\times t \\times {(1 - {t \\over td})} \\times \\exp({-t \\over \\tau}) \\] As can be seen on the picture below, with a DIA of 300 min and tp = 55 min (dark orange curves), 80\\% of the insulin has been absorbed and its activity has declined to 10\\% of its peak value after 180 min:","title":"Mealtime Insulin"},{"location":"model/mealtime/#modeling-the-activity-of-mealtime-insulins","text":"While simple \"bilinear\" models have been used in the past, precise modeling has been done for aspart and lispro. The biexponential model by Dragan Maksimovic described here fits the published data from clamp studies. Dragan has made a tremendous work with this model, adopted now by all DIY artificial pancreas algorithms. A very good explanation of this various models in given in the openAPS documentation . I use model to this compute the activity of each mealtime insulin dose. I selected a time-to-peak of 60 minutes and a duration of insulin action (DIA) of 300 min (5 hours!) as default. Mealtime insulins have a duration of activity closer to 180 min or 3 hours. For faster insulin aspart (Fiasp\u00ae), you may want to choose an even shorter time-to-peak and DIA. You will be able to set your own time-to-peak and DIA values during the interactive setup, along with other \"patient-related\" variables. In simple terms, this means that the effect of insulin will increase from the moment of injection until it reaches a maximum \"peak\", and then decrease to 0 at the end of the DIA.","title":"Modeling the activity of mealtime insulins"},{"location":"model/mealtime/#parameters","text":"td = duration duration of insulin activity (DIA) tp = peak activity time \\[ \\text{Time constant of exponential decay = } \\tau = { tp \\times {{(1-tp/td)}\\over {(1-2 \\times tp/td)} } } \\] \\[ \\text{Rise time factor = } a = { 2 \\times {\\tau \\over td}} \\] \\[ \\text{Auxiliary scale factor = } S = {1 \\over {(1 -a) + (1 + a)\\times {\\exp({-t\\over \\tau})}}} \\] \\[ \\text{Insulin activity curve = } Ia(t) = {S \\over \\tau^2} \\times t \\times {(1 - {t \\over td})} \\times \\exp({-t \\over \\tau}) \\] As can be seen on the picture below, with a DIA of 300 min and tp = 55 min (dark orange curves), 80\\% of the insulin has been absorbed and its activity has declined to 10\\% of its peak value after 180 min:","title":"Parameters"},{"location":"model/overview/","text":"Overview \u2301 Here you'll find details about the sequence of events happening in the simulation. When your simulation has been kickstarted , 3 sensor glucose values of 5 mmol/l or 90 md/dl (sgv) have been uploaded to your Nightscout (NS) website. The \"inner clock\" of the computer hosting the simulation will trigger the execution of various scripts at regular intervals. Sequence of events gather previous sensor glucose values gather previous \"treatments\" (food and/or insulin doses) compute the endogenous glucose production (EGP) compute a random variability factor (RND) compute the global impact of treatments, EGP and RND on glucose values (delta) compute the direction of arrows based on the previous deltas upload a new sensor glucose value and arrow to NS every 5 minutes repeat the cycle indefinitely ISF, CR, CF, BGI \u2301 The Insulin Sensitivity Factor (ISF) represents the impact on BG attributable to the effect of 1 unit of insulin. Its measurement usint is mmol/l/U. So an ISF of 2 means that the blood sugar concentration decreases 2 mmol/l for each given insulin unit. The Carb Ratio (CR) represents the amount of insulin needed to counteract a defined amount of carbs. It is expressed as g/U. For example if 10g of carbs are counteracted by 1 unit of mealtime insulin, the CR is 10 g/U. The Carb (sensitivity) Factor (CF) represents the impact of a defined amount of absorbed carbs on the blood glucose concentration. It can be expressed on mmol/l/g. A simple way to compute is the following: if 1 unit of insulin is needed to decrease BG by 2 mmol/l, and the same 1 U of insulin is needed to counteract 20g or carbs, then the CF is 2 mmol/l / 20g or 1 mmol/l/10g. (CF = CR/ISF) The BGI or Blood Glucose Impact is the absolute change in BG concentration due an amount of insulin or carbs. Examples : With an ISF of 2.5, the BGI of 4 units of insulin is 4U * 2.5mmol/l/U = 10 mmol/l (decrease in BG) With a CF of 1.8, the BGI of 50 grams of carbs is 50g * 1.8 mmol/l/g = 9 mmol/l (increase in BG) Linear, polynomial, exponential models \u2301 The cumulative BGI of all these factors combined is called the \"delta\", or change from the previous BG value. Is is calculated for 5 minute intervals, then added (or substracted from the previous sensor glucose value). It does not describe how fast the change is happening . The Blood Glucose Impact of 1 unit of mealtime insulin is achieved at the end of the duration os action of insulin (DIA), and the BGI of 50g of carbs is achieved as the whole meal is absorbed, sometimes only 6 hours after the meal is comsumed. Describing the intensity of the effect of insulin or carbs along time is called modeling. Models in detail Next we'll see in detail how various insulins, food, endogenous glucose production and random effect can be modeled mathematically.","title":"Overview"},{"location":"model/overview/#overview","text":"Here you'll find details about the sequence of events happening in the simulation. When your simulation has been kickstarted , 3 sensor glucose values of 5 mmol/l or 90 md/dl (sgv) have been uploaded to your Nightscout (NS) website. The \"inner clock\" of the computer hosting the simulation will trigger the execution of various scripts at regular intervals. Sequence of events gather previous sensor glucose values gather previous \"treatments\" (food and/or insulin doses) compute the endogenous glucose production (EGP) compute a random variability factor (RND) compute the global impact of treatments, EGP and RND on glucose values (delta) compute the direction of arrows based on the previous deltas upload a new sensor glucose value and arrow to NS every 5 minutes repeat the cycle indefinitely","title":"Overview"},{"location":"model/overview/#isf-cr-cf-bgi","text":"The Insulin Sensitivity Factor (ISF) represents the impact on BG attributable to the effect of 1 unit of insulin. Its measurement usint is mmol/l/U. So an ISF of 2 means that the blood sugar concentration decreases 2 mmol/l for each given insulin unit. The Carb Ratio (CR) represents the amount of insulin needed to counteract a defined amount of carbs. It is expressed as g/U. For example if 10g of carbs are counteracted by 1 unit of mealtime insulin, the CR is 10 g/U. The Carb (sensitivity) Factor (CF) represents the impact of a defined amount of absorbed carbs on the blood glucose concentration. It can be expressed on mmol/l/g. A simple way to compute is the following: if 1 unit of insulin is needed to decrease BG by 2 mmol/l, and the same 1 U of insulin is needed to counteract 20g or carbs, then the CF is 2 mmol/l / 20g or 1 mmol/l/10g. (CF = CR/ISF) The BGI or Blood Glucose Impact is the absolute change in BG concentration due an amount of insulin or carbs. Examples : With an ISF of 2.5, the BGI of 4 units of insulin is 4U * 2.5mmol/l/U = 10 mmol/l (decrease in BG) With a CF of 1.8, the BGI of 50 grams of carbs is 50g * 1.8 mmol/l/g = 9 mmol/l (increase in BG)","title":"ISF, CR, CF, BGI"},{"location":"model/overview/#linear-polynomial-exponential-models","text":"The cumulative BGI of all these factors combined is called the \"delta\", or change from the previous BG value. Is is calculated for 5 minute intervals, then added (or substracted from the previous sensor glucose value). It does not describe how fast the change is happening . The Blood Glucose Impact of 1 unit of mealtime insulin is achieved at the end of the duration os action of insulin (DIA), and the BGI of 50g of carbs is achieved as the whole meal is absorbed, sometimes only 6 hours after the meal is comsumed. Describing the intensity of the effect of insulin or carbs along time is called modeling. Models in detail Next we'll see in detail how various insulins, food, endogenous glucose production and random effect can be modeled mathematically.","title":"Linear, polynomial, exponential models"},{"location":"model/physical/","text":"Modeling exercise \u2301 Physical activity of various intensity affects glucose homeastasis in many ways. Intense activity triggers adrenalin release and increases the EGP transiently, while the muscles consume their own glycogen stores. There is an initial steep rise in BG. Less intense activity increases the Peripheral Glucose Uptake (PGU) and the BG will start to decline after 15-30 min. If physical activity continues, the PGU remains higher also in the post-exercise state, as the muscles replenish their glycogen stores for the next time they will be required. Quantifying activity requires motion sensors, heart rate sensors, etc... There is work in progress not yet described here, mainly involving smart watches counting steps and heart rate. This is not included in the present version of the simulation (yet).","title":"Physical activity"},{"location":"model/physical/#modeling-exercise","text":"Physical activity of various intensity affects glucose homeastasis in many ways. Intense activity triggers adrenalin release and increases the EGP transiently, while the muscles consume their own glycogen stores. There is an initial steep rise in BG. Less intense activity increases the Peripheral Glucose Uptake (PGU) and the BG will start to decline after 15-30 min. If physical activity continues, the PGU remains higher also in the post-exercise state, as the muscles replenish their glycogen stores for the next time they will be required. Quantifying activity requires motion sensors, heart rate sensors, etc... There is work in progress not yet described here, mainly involving smart watches counting steps and heart rate. This is not included in the present version of the simulation (yet).","title":"Modeling exercise"},{"location":"model/random/","text":"Random effects \u2301 Perlin noise \u2301 Since random number generators produce very jumpy values with various distributions between defined limits, I preferred trying a smoother, more \"organic\" noise function curve. If you have never heard or Ken Perlin, he developed an algorithm generating natural looking textures for Disney's computer animated sci-fi movie Tron in 1982. It can be used to generated 1-, 2-, 3- or n-dimensional arrays of values, which is perfect for this simulation. Using a one-dimensional perlin-noise generator , an array of 17 * 17 = 289 values is produced every 24 hours. A period of 24 hours counts 1440 minutes, or 288 intervals of 5 minutes. Each value gets a timestamp in 5 minute increments. The mean variation is 0, which means that this background noise will cause temporary increases and decreases in BG, without major interference on the deflections caused by insulin, food or EGP. Astronomy \u2301 Did I say something about the influence of the moon phase and planet alignment earlier? Well, this might very well be integrated here very soon... \ud83d\ude04","title":"Random variation"},{"location":"model/random/#random-effects","text":"","title":"Random effects"},{"location":"model/random/#perlin-noise","text":"Since random number generators produce very jumpy values with various distributions between defined limits, I preferred trying a smoother, more \"organic\" noise function curve. If you have never heard or Ken Perlin, he developed an algorithm generating natural looking textures for Disney's computer animated sci-fi movie Tron in 1982. It can be used to generated 1-, 2-, 3- or n-dimensional arrays of values, which is perfect for this simulation. Using a one-dimensional perlin-noise generator , an array of 17 * 17 = 289 values is produced every 24 hours. A period of 24 hours counts 1440 minutes, or 288 intervals of 5 minutes. Each value gets a timestamp in 5 minute increments. The mean variation is 0, which means that this background noise will cause temporary increases and decreases in BG, without major interference on the deflections caused by insulin, food or EGP.","title":"Perlin noise"},{"location":"model/random/#astronomy","text":"Did I say something about the influence of the moon phase and planet alignment earlier? Well, this might very well be integrated here very soon... \ud83d\ude04","title":"Astronomy"},{"location":"operate/insulin/","text":"","title":"Declaring insulin doses"},{"location":"operate/meals/","text":"","title":"Declaring meals"},{"location":"operate/overview/","text":"","title":"Overview"},{"location":"operate/reports/","text":"","title":"View reports"}]}