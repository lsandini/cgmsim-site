<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://lsandini.github.io/cgmsim-site/model/random/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Random variation - CGMSIM</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../../stylesheets/admonitions.css" rel="stylesheet" />
        <link href="../../stylesheets/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Random variation";
        var mkdocs_page_input_path = "model/random.md";
        var mkdocs_page_url = "/cgmsim-site/model/random/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-9DEJWGQQJ5"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-9DEJWGQQJ5');
      </script>
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../..">
          <img src="../../logo.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Mathematical Model</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mealtime/">Mealtime Insulin</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../la-agonists/">Long-acting insulin Agonists</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../food/">Carb absorption from the gut</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../liver/">Endogenous Glucose production</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../physical/">Physical activity</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Random variation</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#perlin-noise">Perlin noise</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#astronomy">Astronomy</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Installation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../build/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../build/nightscout/">Nightscout</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../build/linux/">Linux/Ubuntu</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../build/clone/">Download</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../build/setupscript/">Setup script</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../build/kickstart/">Kickstart</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Using the simulator</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../operate/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operate/meals/">Declaring meals and mealtime insulin</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operate/insulin/">Declaring long-acting insulins</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operate/pump/">Pump mode and DIYAPS</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../operate/reports/">View reports</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../contact/">Contact me</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">CGMSIM</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Mathematical Model &raquo;</li>
      <li>Random variation</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="random-effects">Random effects<a class="headerlink" href="#random-effects" title="Permanent link">⌁</a></h1>
<h2 id="perlin-noise">Perlin noise<a class="headerlink" href="#perlin-noise" title="Permanent link">⌁</a></h2>
<p>Since random number generators produce very "jumpy" values with various distributions between defined limits, I preferred trying a smoother, more "organic" noise function curve. </p>
<p>If you have never heard or Ken Perlin, he developed an algorithm generating natural looking textures, used for example in Disney's computer animated sci-fi movie <a href="https://www.imdb.com/title/tt0084827">Tron</a> in 1982. It can be used to generate 1-, 2-, 3- or n-dimensional arrays of values, which is perfect for this simulation.  </p>
<p>Using a <a href="https://github.com/andrewrk/node-perlin-noise#readme">one-dimensional perlin-noise generator</a>, an array of 17 * 17 = 289 values is produced at regular intervals. A period of 24 hours has 1440 minutes, or 288 intervals of 5 minutes. Each value is attributed a timestamp in 5 minute increments. </p>
<p>The mean variation is 0, which means that this background noise will cause temporary increases and decreases in BG, without major interference on the deflections caused by insulin, food or EGP.</p>
<p>This animation rendered in <a href="https://p5js.org/">p5.js</a> illustrates a continuously oscillating perlin noise curve:</p>
<iframe style="width: 400px; height: 250px; overflow: hidden;"  scrolling="no" frameborder="0" src="https://editor.p5js.org/lsandini/full/F1CtK8SNk"></iframe>
<p><br></p>
<h2 id="astronomy">Astronomy<a class="headerlink" href="#astronomy" title="Permanent link">⌁</a></h2>
<p>As many T1D patients say as a joke from time to time, their blood sugar variations seem to be "influnced by the stars, the planets and the Moon...". Jokes apart, CGMSIM v2.0 lacked this kind of variability over time, and was felt as "too static" by some users, despite the perlin variation described above. </p>
<p>Adding cyclic monthly fluctuations (according to the Moon cycle), and some other slower varying fluctuation (based on the Planets' position in the Solar System), sounded like a fun coding challenge.</p>
<div class="admonition warning">
<p class="admonition-title">Disclaimer</p>
<ul>
<li>
<p>There is no scientific indication that the movements of the Stars or Planets above, or the phase of the Moon have any direct impact on a living person's blood sugar variation. </p>
</li>
<li>
<p>Including these variables in the model only adds a <strong>tiny variation over time</strong>, and some difficulty for the simulator user.</p>
</li>
</ul>
<p><strong> This astronomical influence model could be replaced by any other calculation, and is mainly here as a fun factor!</strong>  </p>
</div>
<p>The coordinates of the Planets of the Solar System can be computed in various reference systems. Heliocentric (Sun-centered), or Geocentric (Earth-centered) for example. I decided to centralize these computations in a separate application, running in the cloud here: <a href="https://astro6.herokuapp.com">Astronomical Computations</a>. This application uses precise formulas based on Jean Meeus 'Astronomical Algorithms' book and the VSOP87 theory. They are gathered in an <a href="https://github.com/andrmoel/astronomy-bundle-js">open-source bundle</a>.</p>
<p>CGMSIM will automatically retrieve the geocentrical longitudes of Mercury, Venus, Mars, Jupiter, Saturn and Neptune and their distances, as seen from Earth. The phase of the Moon is also retrieved.</p>
<p>Using Newton's Law of Universal Gravitation, and using the mass and distance data, each planet's individual gravitational attraction force (or "pull") applied to the simulated subject is computed. Since every planet is pulling the subject in a different direction, a global pull vector is computed.</p>
<p>If all planets were "aligned", they all would be pulling in the same direction. This happens once in a gazillion years, and not in the near future... So I computed a "conjunction factor", describing how the planets are dispersed around us. A low dispersion (or high conjuction) will further amplify the apparent gravitational force. </p>
<p>Finally, the phase of the Moon will influence the CGM curve. The Moon's illumination factor is 100% at the Full Moon, and 0% at the New Moon. The Moon cycle is 29.53 days...</p>
<p><img src="https://user-images.githubusercontent.com/24463821/90344480-44543f00-dfe8-11ea-9b99-a640c0f26136.gif" alt="Solar system" width="200"/></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../physical/" class="btn btn-neutral float-left" title="Physical activity"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../build/overview/" class="btn btn-neutral float-right" title="Overview">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../physical/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../build/overview/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../javascripts/config.js" defer></script>
      <script src="../../javascripts/extra.js" defer></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6" defer></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
